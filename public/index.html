<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>KUSUMA AI</title>
<style>
  :root{
    --bg:#0d1117; --panel:#161b22; --text:#e6edf3;
    --bubble-ai:#238636; --bubble-user:#005cc5;
    --glow:#00f0ff; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  body.light{
    --bg:#f5f7fb; --panel:#ffffff; --text:#0f172a;
    --bubble-ai:#d1f7d1; --bubble-user:#b0d8ff;
    --glow:#0077ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Poppins,system-ui,Segoe UI,Roboto,Arial;
    height:100vh; display:flex; flex-direction:column;
    background: var(--bg); color:var(--text);
    overflow:hidden;
  }

  header{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    background:linear-gradient(90deg, rgba(0,0,0,.25), rgba(0,0,0,.05));
    padding:14px 16px; backdrop-filter: blur(6px); border-bottom:1px solid rgba(255,255,255,.06);
  }
  .brand{display:flex; align-items:center; gap:10px}
  .neon-ring{
    width:46px; height:46px; border-radius:50%;
    padding:3px; background: conic-gradient(from 0deg, var(--glow), transparent 60%, var(--glow));
    box-shadow:0 0 14px var(--glow);
  }
  .neon-ring img{width:100%; height:100%; border-radius:50%}
  h1{font-size:20px; margin:0; text-shadow:0 0 14px var(--glow)}

  .actions{display:flex; align-items:center; gap:10px}
  .btn{
    border:none; cursor:pointer; background: var(--glow);
    color:#012; font-weight:700; border-radius:10px; padding:8px 10px;
    box-shadow:0 0 14px var(--glow);
  }
  .globe{
    width:36px; height:36px; border-radius:50%;
    overflow:hidden; border:2px solid var(--glow);
    box-shadow:0 0 10px var(--glow);
  }
  .globe img{width:100%; height:100%; object-fit:cover;}

  #chat{
    flex:1;
    min-height:0;
    overflow-y:auto;
    padding:18px 14px;
    scroll-behavior:smooth;
    display:flex; flex-direction:column; gap:12px;
  }
  .row{display:flex; gap:10px; align-items:flex-end}
  .row.user{justify-content:flex-end}
  .row .avatar{width:36px; height:36px; border-radius:50%; flex:0 0 auto}
  .row .avatar img{width:100%; height:100%; border-radius:50%}
  .bubble{
    max-width:72%; padding:12px 14px; border-radius:16px; line-height:1.5;
    background:var(--panel); color:var(--text); box-shadow:var(--shadow);
    white-space:pre-wrap;
  }
  .row.ai .bubble{background:var(--bubble-ai); color:#fff; border-bottom-left-radius:6px}
  .row.user .bubble{background:var(--bubble-user); color:#fff; border-bottom-right-radius:6px}

  /* bar input pindah ke bawah */
  #bar{
    display:flex; gap:10px; padding:12px; background:rgba(0,0,0,.15);
    border-top:1px solid rgba(255,255,255,.06);
    margin-top:auto; /* ‚úÖ biar selalu nempel di bawah */
  }
  #prompt{
    flex:1; padding:12px 14px; border-radius:12px;
    border:1px solid rgba(255,255,255,.15);
    background:var(--panel); color:var(--text);
  }
  #send{
    padding:12px 18px; border:none; border-radius:12px; cursor:pointer; font-weight:700;
    background:var(--glow); color:#012; box-shadow:0 0 16px var(--glow);
  }

  /* modal notif */
  #notif{
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center;
    z-index:1000;
  }
  #notif .box{
    background:var(--panel); padding:20px; border-radius:14px;
    text-align:center; box-shadow:0 0 20px var(--glow);
    max-width:300px;
  }
  #notif img{width:80px; height:80px; border-radius:50%; margin-bottom:12px}
  #notif button{
    margin-top:12px; padding:10px 16px; border:none; border-radius:10px;
    background:var(--glow); font-weight:700; cursor:pointer;
  }
</style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="neon-ring"><img src="https://files.catbox.moe/v25xqs.jpg"/></div>
      <h1>KUSUMA AI</h1>
    </div>
    <div class="actions">
      <div class="globe"><img src="https://files.catbox.moe/v25xqs.jpg"/></div>
      <button id="musicToggle" class="btn">üéµ</button>
      <button id="modeToggle" class="btn">üåô</button>
    </div>
  </header>

  <div id="chat"></div>

  <!-- input bar di bawah -->
  <div id="bar">
    <input id="prompt" placeholder="Ketik pesan..." autocomplete="off"/>
    <button id="send">Kirim</button>
  </div>

  <!-- Notifikasi awal -->
  <div id="notif">
    <div class="box">
      <img src="https://files.catbox.moe/v25xqs.jpg" alt="AI">
      <h2>Welcome!!</h2>
      <p>I Am Kusuma AI Created By Wijaya To Help You üåè</p>
      <button onclick="closeNotif()">Mulai</button>
    </div>
  </div>

<script>
const chat=document.getElementById('chat');
const promptEl=document.getElementById('prompt');
const sendBtn=document.getElementById('send');
const modeToggle=document.getElementById('modeToggle');
const musicToggle=document.getElementById('musicToggle');
const notif=document.getElementById('notif');
const bgMusic=new Audio("https://files.catbox.moe/ed2aa8.mp3");
bgMusic.loop=true;

const AV_AI="https://files.catbox.moe/v25xqs.jpg";
const AV_USER="https://files.catbox.moe/55ojop.jpg";

function closeNotif(){notif.style.display='none'; promptEl.focus();}

// tambah message ke chat
function rowEl(side){
  const r=document.createElement('div'); r.className='row '+side;
  const avatar=document.createElement('div'); avatar.className='avatar';
  const img=document.createElement('img'); img.src=side==='ai'?AV_AI:AV_USER;
  avatar.appendChild(img);
  const bubble=document.createElement('div'); bubble.className='bubble';
  r.appendChild(side==='ai'?avatar:bubble);
  r.appendChild(side==='ai'?bubble:avatar);
  return {r,bubble};
}
function addMessage(text,side){
  const {r,bubble}=rowEl(side);
  bubble.textContent=text;
  chat.appendChild(r);
  r.scrollIntoView({ behavior: "smooth", block: "end" });
}

// kirim pesan ke API
async function sendMessage(text){
  if(!text){text=promptEl.value.trim();}
  if(!text) return;
  addMessage(text,'user');
  promptEl.value=""; promptEl.focus();

  try{
    const res=await fetch('/ai',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ text })
    });
    const data=await res.json();

    let answer=(data.answer||data.output||data.result||JSON.stringify(data));
    if(!answer || answer.trim()==="") answer="‚ö†Ô∏è tidak menemukan jawaban.";

    answer = answer.replace(/n\\/g, "\n").replace(/\\n/g, "\n");

    addMessage(answer,'ai');
  }catch(err){
    addMessage("‚ùå Error mengambil jawaban dari server.",'ai');
  }
}

sendBtn.addEventListener('click',()=>sendMessage());
promptEl.addEventListener('keydown',e=>{if(e.key==='Enter')sendMessage();});

modeToggle.addEventListener('click',()=>{
  document.body.classList.toggle('light');
  modeToggle.textContent=document.body.classList.contains('light')?'üåô':'‚òÄÔ∏è';
});
musicToggle.addEventListener('click',()=>{
  if(bgMusic.paused){bgMusic.play(); musicToggle.textContent="‚è∏Ô∏è";}
  else{bgMusic.pause(); musicToggle.textContent="üéµ";}
});

// auto fokus supaya keyboard langsung muncul
window.onload=()=>{
  setTimeout(()=>{
    promptEl.focus();
    promptEl.click();
  },500);
};
document.body.addEventListener('click',()=>{
  promptEl.focus();
},{once:true});
</script>
</body>
  </html>
